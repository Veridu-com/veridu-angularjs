<!DOCTYPE html><html lang="en"><head><title>src/angularjs-veridu-sdk</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/angularjs-veridu-sdk"><meta name="groc-project-path" content="src/angularjs-veridu-sdk.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/angularjs-veridu-sdk.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-pi">    'use strict'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="creating-module">Creating module</h6></div></div></div><div class="segment"><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span> = angular.module(<span class="hljs-string">'veridu.angular.sdk'</span>, []);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="creating-provider">Creating provider</h6></div></div></div><div class="segment"><div class="code"><div class="wrapper">    <span class="hljs-built_in">module</span>.provider(<span class="hljs-string">'Veridu'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">VeriduProvider</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> client,
            user,
            session;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="constructor-functionclient-user-session-lang-api-version">Constructor function(client, user, session, lang, API_VERSION)</h6>
<hr>
<ul>
<li><em>string <strong>client</strong> client id </em></li>
<li><em>string <strong>user</strong> username</em></li>
<li><em>string <strong>lang</strong> language, defaults to &#39;en-us&#39;</em></li>
<li><p><em>string <strong>API_VERSION</strong> API version, defaults to &#39;0.3&#39;</em></p>
<p>The user must configure the provider within the configuration phase of the angular app.
<em>other parameters are injected automatically</em></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> service = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">client, user, session, lang, API_VERSION, $httpParamSerializerJQLike, $http, $log</span>)</span>{
            <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">this</span>;
            vm.user = {};
            vm.Util = <span class="hljs-keyword">new</span> Util();
            vm.API = {
                fetch: apiFetch
            };

            <span class="hljs-keyword">if</span> (! valid(<span class="hljs-built_in">arguments</span>))
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;

            vm.cfg = {
                user: user,
                client: client,
                session: session,
                lang: lang || <span class="hljs-string">'en-us'</span>,
                get API_VERSION() { <span class="hljs-keyword">return</span> API_VERSION  || <span class="hljs-string">'0.3'</span>; },
                get URL() {
                    <span class="hljs-keyword">return</span> {
                        api: <span class="hljs-string">'https://api.veridu.com/'</span>,
                        widget: <span class="hljs-string">'https://widget.veridu.com/'</span>,
                        assets: <span class="hljs-string">'https://assets.veridu.com/'</span>
                    }
                }
            };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="function-apifetchmethod-resource-parameters">function apiFetch(method, resource, parameters)</h6>
<hr>
<p>  Fetches the API</p>
<ul>
<li><em>string <strong>method</strong>  &#39;GET&#39;, &#39;PUT&#39;, &#39;POST&#39;, &#39;DELETE&#39;</em></li>
<li><em>string <strong>resource</strong>   part of URI</em></li>
<li><em>mixed <strong>parameters</strong> request params</em></li>
</ul></div></div><div class="code"><div class="wrapper">            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apiFetch</span>(<span class="hljs-params">method, resource, parameters</span>) </span>{

                <span class="hljs-keyword">var</span> availableMethods = [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'PUT'</span>, <span class="hljs-string">'POST'</span>, <span class="hljs-string">'DELETE'</span>];

                <span class="hljs-keyword">if</span> (! resource) {
                    $log.error(<span class="hljs-string">'Calling API.fetch with invalid resource parameter! ('</span> + resource + <span class="hljs-string">')'</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                <span class="hljs-keyword">if</span> (availableMethods.indexOf(method.toUpperCase()) == -<span class="hljs-number">1</span>) {
                    $log.error(<span class="hljs-string">'Calling API.fetch with invalid method parameter! ('</span> + method + <span class="hljs-string">')'</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                <span class="hljs-keyword">return</span> $http({
                    method: method,
                    url: vm.Util.apiUrl(resource),
                    headers: {
                        <span class="hljs-string">'Veridu-Client'</span>: vm.cfg.client,
                        <span class="hljs-string">'Veridu-Session'</span>: vm.cfg.session
                    },
                    params: parameters || {},
                    paramSerializer: <span class="hljs-string">'$httpParamSerializerJQLike'</span>
                });


            };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="function-util">function Util</h6>
<hr>
<p>  Helper functions</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Util</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.buildUrl = buildUrl;
                <span class="hljs-keyword">this</span>.apiUrl = apiUrl;
                <span class="hljs-keyword">this</span>.widgetUrl = widgetUrl;
                <span class="hljs-keyword">this</span>.assetsUrl = assetsUrl;
                <span class="hljs-keyword">this</span>.getProviderUrl = getProviderUrl;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="url-helpersresource-params">Url Helpers(resource, params)</h6>
<hr>
<p>  Creates a route to the chosen endpoint API, assets or widget.</p>
<ul>
<li><em>string <strong>resource</strong> part of the URI</em></li>
<li><em>mixed|string <strong>params</strong> parementers</em></li>
</ul></div></div><div class="code"><div class="wrapper">                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apiUrl</span>(<span class="hljs-params">resource, params</span>) </span>{
                    <span class="hljs-keyword">return</span> buildUrl(vm.cfg.URL.api + vm.cfg.API_VERSION + <span class="hljs-string">'/'</span> + resource + <span class="hljs-string">'/'</span>, params);
                }
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assetsUrl</span>(<span class="hljs-params">resource, params</span>) </span>{
                    <span class="hljs-keyword">return</span> buildUrl(vm.cfg.URL.assets + vm.cfg.API_VERSION + <span class="hljs-string">'/'</span> + resource, params);
                }
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widgetUrl</span>(<span class="hljs-params">resource, params</span>) </span>{
                    <span class="hljs-keyword">return</span> buildUrl(vm.cfg.URL.widget + vm.cfg.API_VERSION + <span class="hljs-string">'/'</span> + resource + <span class="hljs-string">'/'</span>, params);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildUrl</span>(<span class="hljs-params">url, params</span>) </span>{
                    <span class="hljs-keyword">if</span> (params) {
                        <span class="hljs-keyword">if</span> (url.indexOf(<span class="hljs-string">'?'</span>) &gt; -<span class="hljs-number">1</span>)
                            url += <span class="hljs-string">'&amp;'</span>;
                        <span class="hljs-keyword">else</span>
                            url += <span class="hljs-string">'?'</span>;
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> params == <span class="hljs-string">'string'</span>)
                            <span class="hljs-keyword">return</span> url + params;
                        <span class="hljs-keyword">return</span> url + $httpParamSerializerJQLike(params);
                    }
                    <span class="hljs-keyword">return</span> url;
                }

            }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="function-validargs">function valid(args)</h6>
<hr>
<p>  Check if the injected Provider has the required arguments</p>
<ul>
<li><em>arguments <strong>args</strong> All the arguments that the provider has been called with</em></li>
</ul></div></div><div class="code"><div class="wrapper">            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">valid</span>(<span class="hljs-params">args</span>) </span>{
                <span class="hljs-keyword">var</span> v = <span class="hljs-literal">true</span>;

                v = validate(args[<span class="hljs-number">0</span>], <span class="hljs-string">'client'</span>) &amp;&amp; v;
                v = validate(args[<span class="hljs-number">1</span>], <span class="hljs-string">'user'</span>) &amp;&amp; v;
                v = validate(args[<span class="hljs-number">2</span>], <span class="hljs-string">'session'</span>) &amp;&amp; v;
                v = validate(args[<span class="hljs-number">3</span>], <span class="hljs-string">'lang'</span>) &amp;&amp; v;
                v = validate(args[<span class="hljs-number">4</span>], <span class="hljs-string">'API_VERSION'</span>) &amp;&amp; v;

                <span class="hljs-keyword">return</span> v;
            }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="function-validateprop-propname">function validate(prop, propName)</h6>
<hr>
<p>  Check if the given property is valid for its criteria</p>
<ul>
<li><em>string <strong>propName</strong> property name</em></li>
<li><em>string <strong>prop</strong> property value</em></li>
</ul></div></div><div class="code"><div class="wrapper">            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params">prop, propName</span>) </span>{
                <span class="hljs-keyword">switch</span> (propName) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'user'</span>:
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'client'</span>:
                    <span class="hljs-keyword">case</span> <span class="hljs-string">'session'</span>:
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(prop) === <span class="hljs-string">'undefined'</span>) {
                            <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"Please specify Veridu '"</span> + propName + <span class="hljs-string">"' on the  confguration phase of your application."</span>;
                            $log.error(msg);
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        }
                        <span class="hljs-keyword">break</span>;
                }

                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h6 id="function-getproviderurlprovider">function getProviderUrl(provider)</h6>
<hr>
<p>  Helper function to get common provider urls like twitter, facebook, paypal, linkedin...</p>
<ul>
<li><em>string <em>*provider</em></em> provider&#39;s name</li>
</ul></div></div><div class="code"><div class="wrapper">            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getProviderUrl</span>(<span class="hljs-params">provider</span>) </span>{
                <span class="hljs-keyword">return</span> vm.cfg.URL.widget + vm.cfg.API_VERSION +<span class="hljs-string">'/provider/login/'</span>+ provider +<span class="hljs-string">'/'</span>+ vm.cfg.client +<span class="hljs-string">'/'</span>+ vm.cfg.user +<span class="hljs-string">'?session='</span>+ vm.cfg.session +<span class="hljs-string">'&amp;amp;language='</span> + vm.cfg.lang;
            };

        }

        service.$get = [<span class="hljs-string">'$http'</span>, <span class="hljs-string">'$log'</span>, <span class="hljs-string">'$httpParamSerializerJQLike'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">VeriduFactory</span>(<span class="hljs-params">$http, $log, $httpParamSerializerJQLike</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> service(<span class="hljs-keyword">this</span>.client, <span class="hljs-keyword">this</span>.user, <span class="hljs-keyword">this</span>.session, <span class="hljs-keyword">this</span>.lang, <span class="hljs-keyword">this</span>.API_VERSION, $httpParamSerializerJQLike, $http, $log);
        }];

        <span class="hljs-keyword">return</span> service;
    });

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span>.exports === <span class="hljs-string">'object'</span>) {
        <span class="hljs-built_in">module</span>.exports = <span class="hljs-string">'angular-veridu-sdk'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
        define([], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">'angular-veridu-sdk'</span>;
        });
    }
}());</div></div></div></div></body></html>