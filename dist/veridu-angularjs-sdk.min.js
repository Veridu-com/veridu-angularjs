!function(){"use strict";var e=angular.module("veridu.angularjs.sdk",[]);e.provider("Veridu",function(){var e=function(e,t,i,r,n,o,s,u,a,c){function g(){c.$emit("VeriduLogout",w.profile&&w.profile.user||w.user),w.user={},delete w.profile,delete w.cfg.session,delete w.cfg.user,O.removeItem("cfg"),w.SSO.logout(),h()}function f(){function e(e,t,i){var r=["GET","PUT","POST","DELETE"];return t?-1==r.indexOf(e.toUpperCase())?(u.error("Calling API.fetch with invalid method parameter! ("+e+")"),!1):s({method:e,url:w.Util.apiUrl(t),headers:{"Veridu-Client":w.cfg.client,"Veridu-Session":w.cfg.session},params:i||{},paramSerializer:"$httpParamSerializerJQLike"}):(u.error("Calling API.fetch with invalid resource parameter! ("+t+")"),!1)}this.fetch=e}function d(){function e(){O.removeItem("sso"),c.$emit("VeriduSSOLogout",{cfg:w.cfg,user:w.user}),delete w.SSO.provider,c.$$phase||c.$apply()}function t(e){if(!e)return!1;try{e="string"==typeof e?JSON.parse(e):e,w.SSO.provider=e.veridu_provider,w.user.name=e.veridu_name,w.user.email=e.veridu_email,w.cfg.session=e.veridu_session,w.cfg.user=e.veridu_id,O.setItem("sso",e),c.$$phase||c.$apply(),c.$emit("VeriduSSOLogin",e)}catch(t){return u.error("Error parsing API response"),!1}}function i(e){w.cfg.session&&u.error("User already signed! Logout if you want to access via another SSO provider");var t=w.cfg.URL.widget+"/"+w.cfg.API_VERSION+"/sso/login/"+e+"/"+w.cfg.client+"?language="+w.cfg.lang+"&mobile=true&session="+(w.cfg.session||"")+"&nonce=nonce&redirect="+a.location.toString();l(t,"_system")}this.login=i,this.logout=e,this.populate=t,a.addEventListener("message",function(e){e.origin==w.cfg.URL.widget&&t(e.data)})}function l(e,t){t=t||"_blank";var i=Math.max((screen.height-600)/2,0),r=Math.max((screen.width-800)/2,0),n="status=0,toolbar=0,location=1,resizable=0,scrollbars=0,width=800,height=600,top="+i+",left="+r;return window.open(e,t,n)}function p(){function e(e){var t="https://widget.veridu.com/"+w.cfg.API_VERSION+"/provider/login/"+e+"/"+w.cfg.client+"/"+w.cfg.user+"?session="+w.cfg.session+"&amp;language=en-us";l(t,"_system")}this.login=e}function h(){O.setItem("nonce",w.nonce);var e=O.getItem("cfg");return e?void m(e):(e=O.getItem("sso"))?void w.SSO.populate(e):void 0}function m(e,t){w.cfg.session=e.token,w.cfg.user=e.username,t&&O.setItem("cfg",e)}function v(){function e(e,t){return r(w.cfg.URL.api+w.cfg.API_VERSION+"/"+e+"/",t)}function t(e,t){return r(w.cfg.URL.assets+w.cfg.API_VERSION+"/"+e,t)}function i(e,t){return r(w.cfg.URL.widget+"/"+w.cfg.API_VERSION+"/"+e+"/",t)}function r(e,t){return t?(e+=e.indexOf("?")>-1?"&":"?","string"==typeof t?e+t:e+o(t)):e}this.buildUrl=r,this.apiUrl=e,this.widgetUrl=i,this.assetsUrl=t}function S(e){return"undefined"==typeof e[0]?(u.error("Please specify Veridu 'client' on the  confguration phase of your application."),!1):!0}function I(){function e(e,t){return a.localStorage.setItem("veridu-"+e,JSON.stringify(t))}function t(e){return a.localStorage.removeItem("veridu-"+e)}function i(e){try{return JSON.parse(a.localStorage.getItem("veridu-"+e))}catch(t){return void a.localStorage.removeItem("veridu-"+e)}}this.setItem=e,this.removeItem=t,this.getItem=i}var w=this,O=new I;return this.nonce=O.getItem("nonce")||Math.round(1e8*Math.random()),w.user={},w.initialize=h,w.logout=g,w.Util=new v,w.API=new f,w.SSO=new d,w.Widget=new p,w.cfg={user:r,client:e,session:n,lang:t||"en-us",get API_VERSION(){return i||"0.3"},get URL(){return{api:"https://api.veridu.com/",widget:"https://widget.veridu.com",assets:"https://assets.veridu.com/"}}},h(),S(arguments)?void 0:this};return e.$get=["$http","$log","$httpParamSerializerJQLike","$window","$rootScope",function(t,i,r,n,o){return new e(this.client,this.lang,this.API_VERSION,this.user,this.session,r,t,i,n,o)}],e}),"object"==typeof e&&"object"==typeof e.exports?e.exports="veridu-angularjs-sdk":"function"==typeof define&&define.amd&&define([],function(){return"veridu-angularjs-sdk"})}();