!function(){"use strict";var e=angular.module("veridu.angularjs.sdk",[]);e.provider("Veridu",function(){var e=function(e,t,r,i,n,o,s,a,u,c){function d(){O.cfg={user:i,client:e,session:n,lang:t||"en-us",get API_VERSION(){return r||"0.3"},get URL(){return{api:"https://api.veridu.com/",widget:"https://widget.veridu.com",assets:"https://assets.veridu.com/"}}},p(y.getItem("veriduSSOData")),u.addEventListener("message",function(e){e.origin==O.cfg.URL.widget&&p(e.data)})}function f(e,t,r){var i=["GET","PUT","POST","DELETE"];return t?-1==i.indexOf(e.toUpperCase())?(a.error("Calling API.fetch with invalid method parameter! ("+e+")"),!1):s({method:e,url:O.Util.apiUrl(t),headers:{"Veridu-Client":O.cfg.client,"Veridu-Session":O.cfg.session},params:r||{},paramSerializer:"$httpParamSerializerJQLike"}):(a.error("Calling API.fetch with invalid resource parameter! ("+t+")"),!1)}function g(e){return O.cfg.session?(a.error("User already signed! Logout if you want to access via another SSO provider"),!1):void window.open(O.cfg.URL.widget+"/"+O.cfg.API_VERSION+"/sso/login/"+e+"/"+O.cfg.client+"?language="+O.cfg.lang+"&mobile=true&session=&nonce=nonce&redirect="+u.location.toString(),"_system")}function l(){y.removeItem("veriduSSOData"),c.$emit("veriduSSOLogout",{cfg:O.cfg,user:O.user}),delete O.cfg.session,delete O.cfg.user,delete O.SSO.provider,delete O.user.name,delete O.user.email,c.$$phase||c.$apply()}function p(e){if(!e)return!1;try{e="string"==typeof e?JSON.parse(e):e,O.cfg.session=e.veridu_session,O.cfg.user=e.veridu_id,O.SSO.provider=e.veridu_provider,O.user.name=e.veridu_name,O.user.email=e.veridu_email,y.setItem("veriduSSOData",e),c.$$phase||c.$apply(),c.$emit("veriduSSOLogin",e)}catch(t){return a.error("Error parsing API response"),!1}}function m(){function e(e,t){return i(O.cfg.URL.api+O.cfg.API_VERSION+"/"+e+"/",t)}function t(e,t){return i(O.cfg.URL.assets+O.cfg.API_VERSION+"/"+e,t)}function r(e,t){return i(O.cfg.URL.widget+"/"+O.cfg.API_VERSION+"/"+e+"/",t)}function i(e,t){return t?(e+=e.indexOf("?")>-1?"&":"?","string"==typeof t?e+t:e+o(t)):e}this.buildUrl=i,this.apiUrl=e,this.widgetUrl=r,this.assetsUrl=t}function v(e){return"undefined"==typeof e[0]?(a.error("Please specify Veridu 'client' on the  confguration phase of your application."),!1):!0}function S(e,t){return u.localStorage.setItem(e,JSON.stringify(t))}function h(e){return u.localStorage.removeItem(e)}function I(e){try{return JSON.parse(u.localStorage.getItem(e))}catch(t){return void u.localStorage.removeItem(e)}}var O=this;O.user={},O.Util=new m,O.API={fetch:f},O.SSO={login:g,logout:l};var y={setItem:S,removeItem:h,getItem:I};return d(),v(arguments)?void 0:this};return e.$get=["$http","$log","$httpParamSerializerJQLike","$window","$rootScope",function(t,r,i,n,o){return new e(this.client,this.lang,this.API_VERSION,this.user,this.session,i,t,r,n,o)}],e}),"object"==typeof e&&"object"==typeof e.exports?e.exports="veridu-angularjs-sdk":"function"==typeof define&&define.amd&&define([],function(){return"veridu-angularjs-sdk"})}();